<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<recordset table="displaycache">
  <record id="language=&quot;ENG&quot; and screen.id=&quot;add.edit.fieldRights.default&quot;" recordid="ENG - add.edit.fieldRights.default">
    <unl>kC0cYWRkLmVkaXQuZmllbGRSaWdodHMuZGVmYXVsdC8fLy8vkC0cYWRkLmVk
aXQuZmllbGRSaWdodHMuZGVmYXVsdCtFTkfdCCRMLnRpdGxl3QkkTC5mb3Jt
YXRBP5CAgU8vkS0GcmV0dXJukE8vLyxsZWZ0Hx+RLRxhZGQuZWRpdC5maWVs
ZFJpZ2h0cy5kZWZhdWx0T08QLQZyb2xmZWw9CEHPhU/QkRERTy9PkU+AExUZ
CxkNGSEaA+eBgC8vLy8vLRImQ2xvc2UgQXBwbGljYXRpb26BgEHdDyRMLmFs
bG93LmZpbmlzaKSkqQipfd0IJEwuc3RhcnRAoECgqQipfd0YJEwuZGlzYWJs
ZS5uZXh0LnByZXZpb3VzQKBAoKCpCKl93RMkTC5kaXNhYmxlLnByZXZpb3Vz
QKBAoKBBQUGBgIAtBmNhbmNlbIGALQZmaW5pc2iBgC0IcHJldmlvdXOBgC0K
ZG8gbm90aGluZ4GAgYAtBWNsb3NlgYGAD4CpFKkI3QskTC5jb25kVHlwZS0I
cmVhZG9ubHmgoqkX3Q0kTC5maWVsZEluZGV4qRf9CHJlYWRvbmx53QckTC5m
aWxloKCpet0MJEwuY29uZGl0aW9uFKCgoqkX3Q0kTC5maWVsZEluZGV4qRf9
CWludmlzaWJsZd0HJEwuZmlsZaCgqXrdDCRMLmNvbmRpdGlvbhSgoKCBgKl/
3RAkcmlnaHRzQ29uZGl0aW9uoIEPgKkUqQjdDSRMLnJlbW92ZVJvbGVBoKLd
DCRMLmNvbmRpdGlvbt0SJEwud2l0aG91dFJvbGVOYW1loKLdDCRMLmNvbmRp
dGlvbt0PJEwud2l0aFJvbGVOYW1loKCBgYCBgICpf90NJG15U2VsZWN0aW9u
c6Cpf90OJG9yaWdpbmFsUm9sZXOgqX/dECRtYW51YWxDb25kaXRpb26gqX/d
ECRyaWdodHNDb25kaXRpb26ggYCpf90NJG15U2VsZWN0aW9uc6Cpf90OJG9y
aWdpbmFsUm9sZXOgqX/dECRtYW51YWxDb25kaXRpb26gqX/dECRyaWdodHND
b25kaXRpb26gqX/dDyRzdWNjZXNzTWVzc2FnZaCBgYCAQYGAQYGAQYGAQYGA
gYBBgYErRU5HES0GZmFsY29uPQhBz6+X/eZmZoBAQUBAgYAPLgE2Ly8gc2F2
ZSB0aGUgbW9kaWZpZWQgcmVjb3JkCiB2YXIgcmM7CgogIAogIHJjID0gc3lz
dGVtLnZhcnMuJExfZmlsZS5kb1VwZGF0ZSgpOwogIAogCiAgaWYgKCByYyAh
PSB0cnVlKQogIHsKICAgIHByaW50KCAiRXJyb3I6ICIgKyBSQ3RvU3RyaW5n
KHJjKSk7CiAgICAKICB9CgogIGVsc2UgCiAgewogICAgcHJpbnQoIHN5c3Rl
bS52YXJzLiRzdWNjZXNzTWVzc2FnZSk7IC8vIHRoZSBtZXNzYWdlIGlzIGRp
ZmZlcmVudCwgZGVwZW5kaW5nIG9uIHdoZXJlIHdlIGNhbWUgZnJvbSAoIERh
dGEgcG9saWN5IG9yIHNlY3VyaXR5IFJpZ2h0cykKICB9Cg8uCmQKIC8vIGV4
dHJhY3QgdGhlIGV4aXN0aW5nIGNvbmRpdGlvbiBhcnJheSBhbmQgdGhlIG5l
dyBjb25kaXRpb24gYXJyYXkgYW5kIGVsaW1pbmF0ZSBkdXBsaWNhdGVzCgog
ICAKICAgIHZhciBpbmRleFN0YXJ0OyAKCXZhciBpbmRleEVuZCA7ICAKCQog
ICAgdmFyIGV4aXN0aW5nQ29uZDsKICAgIHZhciBuZXdDb25kOwogICAgdmFy
IGV4aXN0aW5nQ29uZEFycmF5ID0gbmV3IEFycmF5KCk7CiAgICB2YXIgbmV3
Q29uZEFycmF5ID0gbmV3IEFycmF5KCk7CiAgICAgICAgIAogICAgICAgICAg
ICAKICAgICAgCiAgICAgIGlmIChzeXN0ZW0udmFycy4kTF9jb25kaXRpb24g
IT0gbnVsbCAmJiBzeXN0ZW0udmFycy4kTF9jb25kaXRpb24gIT0gIiIgKXsK
ICAgICAgICBpbmRleFN0YXJ0ICAgPSBzeXN0ZW0uZnVuY3Rpb25zLmluZGV4
KCJ7IixzeXN0ZW0udmFycy4kTF9jb25kaXRpb24pOwoJICAgIGluZGV4RW5k
ICAgICA9IHN5c3RlbS5mdW5jdGlvbnMuaW5kZXgoIn0iLHN5c3RlbS52YXJz
LiRMX2NvbmRpdGlvbik7ICAgIAogICAgICAgIGV4aXN0aW5nQ29uZCA9IHN5
c3RlbS5mdW5jdGlvbnMuc3Vic3RyKHN5c3RlbS52YXJzLiRMX2NvbmRpdGlv
bixpbmRleFN0YXJ0KzEsKGluZGV4RW5kLWluZGV4U3RhcnQpLTEpOwogICAg
ICAgIGV4aXN0aW5nQ29uZEFycmF5PWV4aXN0aW5nQ29uZC5zcGxpdCgiLCIp
OwogICAgICAgIAogICAgICAgCiAgICAgIH0KICAgICAgCiAgICAgIGlmIChz
eXN0ZW0udmFycy4kcmlnaHRzQ29uZGl0aW9uICE9IG51bGwgJiYgc3lzdGVt
LnZhcnMuJHJpZ2h0c0NvbmRpdGlvbiAhPSAiIiApewogICAgIC8vIG5ldyBj
b25kaXRpb24KICAgICAgICBpbmRleFN0YXJ0ICAgPSBzeXN0ZW0uZnVuY3Rp
b25zLmluZGV4KCJ7IixzeXN0ZW0udmFycy4kcmlnaHRzQ29uZGl0aW9uKTsK
CSAgICBpbmRleEVuZCAgICAgPSBzeXN0ZW0uZnVuY3Rpb25zLmluZGV4KCJ9
IixzeXN0ZW0udmFycy4kcmlnaHRzQ29uZGl0aW9uKTsKCSAgICBuZXdDb25k
ICAgICAgPSBzeXN0ZW0uZnVuY3Rpb25zLnN1YnN0cihzeXN0ZW0udmFycy4k
cmlnaHRzQ29uZGl0aW9uLGluZGV4U3RhcnQrMSwoaW5kZXhFbmQtaW5kZXhT
dGFydCktMSk7CgkgICAgbmV3Q29uZEFycmF5ID0gbmV3Q29uZC5zcGxpdCgi
LCIpOwoJICAgIAogICAgICAgIAogICAgICAgfQogICAgICAgICAgICAgICAg
CiAgICAgICAgLy8gY3JlYXRlIGEgdW5pb24gb2YgZXhpc3RpbmcgYW5kIG5l
dyBjb25kaXRpb25zIHdpdGggbm8gZHVwbGljYXRlcwogICAgICAgCiAgICAg
ICAgLy91cGRhdGUgdGhlIFJBRCBMX2NvbmRpdGlvbiB2YXJpYWJsZSB3aXRo
IHRoZSByZXN1bHQgb2YgdGhlIHVuaW9uIAogICAgICAgIAogICAgICAgaWYg
KGluZGV4U3RhcnQgPiAwICYmIGluZGV4U3RhcnQgIT0gbnVsbCkgewogICAg
ICAgICAgc3lzdGVtLnZhcnMuJExfY29uZGl0aW9uID0gICIkRy5yb2xlIGlz
aW4geyIgKyBtZXJnZVJlbW92ZUR1cGxpY2F0ZXMoZXhpc3RpbmdDb25kQXJy
YXksbmV3Q29uZEFycmF5KSArICJ9Ijs7CiAgICAgICB9CiAgICAgICAKICAg
ICAgCiAgICAgICAgLy90YWtlIGNhcmUgb2YgYW55IG1hbnVhbCBjb25kaXRp
b25zIHNwZWNpZmllZCAgIAogICAKICAgCiAgIAogICBpZiAoc3lzdGVtLnZh
cnMuJG1hbnVhbENvbmRpdGlvbiAhPSBudWxsICYmIHN5c3RlbS52YXJzLiRt
YW51YWxDb25kaXRpb24gIT0gIiIgJiYgaW5kZXhTdGFydCAhPSBudWxsICYm
IGluZGV4U3RhcnQgPiAwKQogICAgICB7CgkgICAgLy9idWlsZCB0aGUgZmlu
YWwgcmlnaHRzIGNvbmRpdGlvbgoJICAgIAoJICAgIHN5c3RlbS52YXJzLiRM
X2NvbmRpdGlvbiA9IHN5c3RlbS52YXJzLiRMX2NvbmRpdGlvbiArICIgb3Ig
KCIgKyBzeXN0ZW0udmFycy4kbWFudWFsQ29uZGl0aW9uICsgIikiOwogICAg
ICB9CgogIGVsc2UgaWYoc3lzdGVtLnZhcnMuJG1hbnVhbENvbmRpdGlvbiAh
PSBudWxsKQogICAgewogICAgIHN5c3RlbS52YXJzLiRMX2NvbmRpdGlvbiA9
IHN5c3RlbS52YXJzLiRtYW51YWxDb25kaXRpb247CiAgICB9CiAgLy8gZnVu
Y3Rpb24gbWVyZ2VzIHR3byBhcnJheXMgYW5kIHJlbW92ZXMgZHVwbGljYXRl
cyBmcm9tIHRoZSByZXN1bHRpbmcgYXJyYXkKIGZ1bmN0aW9uIG1lcmdlUmVt
b3ZlRHVwbGljYXRlcyhhcnJheTEsIGFycmF5MikKICB7CgogICAgIHZhciB1
bmlvbkFycmF5ID0gbmV3IEFycmF5KCk7CiAgICAKICAgICB1bmlvbkFycmF5
ID0gYXJyYXkxLmNvbmNhdChhcnJheTIpOwogICAgICAgICAgICAKICAgICB2
YXIgbmV3QXJyYXk9bmV3IEFycmF5KCk7CiAgICAgbGFiZWw6Zm9yKHZhciBp
PTA7IGk8dW5pb25BcnJheS5sZW5ndGg7aSsrICkKICAgICAgICAgICAgeyAg
CiAgICAgICAgICAgICAgIGZvcih2YXIgaj0wOyBqPG5ld0FycmF5Lmxlbmd0
aDtqKysgKQogICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAg
IGlmKG5ld0FycmF5W2pdPT11bmlvbkFycmF5W2ldKSAKICAgICAgICAgICAg
ICAgICAgICAgIGNvbnRpbnVlIGxhYmVsOwogICAgICAgICAgICAgICAgICB9
CiAgICAgICAgICAgICAgICAgICAgbmV3QXJyYXlbbmV3QXJyYXkubGVuZ3Ro
XSA9IHVuaW9uQXJyYXlbaV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAg
ICAgICAgICByZXR1cm4gbmV3QXJyYXk7CiAgICAgICAgICAgCiB9CgoKCoGA
gZE=</unl>
    <screen.id type="string">add.edit.fieldRights.default</screen.id>
    <form NullValue="1" type="string"/>
    <txt.bank NullValue="1" type="decimal"/>
    <cursor.field.name NullValue="1" type="string"/>
    <cursor.field.contents NullValue="1" type="string"/>
    <current.scroll NullValue="1" type="string"/>
    <screen type="structure">{["add.edit.fieldRights.default", "ENG", $L.title, $L.format, true, , {[{}, , ]}, "return", {[, , , "left", , ]}, "add.edit.fieldRights.default", , , 0, "rolfel", '12/01/10 09:33:08', , , ]}</screen>
    <more.flag NullValue="1" type="boolean"/>
    <ds.opt sctype="array">
      <ds.opt sctype="decimal">3</ds.opt>
      <ds.opt sctype="decimal">5</ds.opt>
      <ds.opt sctype="decimal">11</ds.opt>
      <ds.opt sctype="decimal">13</ds.opt>
      <ds.opt sctype="decimal">33</ds.opt>
      <ds.opt sctype="decimal">999</ds.opt>
    </ds.opt>
    <ds.desc sctype="array">
      <ds.desc sctype="string"/>
      <ds.desc sctype="string"/>
      <ds.desc sctype="string"/>
      <ds.desc sctype="string"/>
      <ds.desc sctype="string"/>
      <ds.desc sctype="string">&amp;Close Application</ds.desc>
    </ds.desc>
    <ds.cond sctype="array">
      <ds.cond sctype="boolean">true</ds.cond>
      <ds.cond sctype="globalVar">$L.allow.finish</ds.cond>
      <ds.cond sctype="operator">nullsub($L.start, false)=false and nullsub($L.disable.next.previous, false)=false and nullsub($L.disable.previous, false)=false</ds.cond>
      <ds.cond sctype="boolean">true</ds.cond>
      <ds.cond sctype="boolean">true</ds.cond>
      <ds.cond sctype="boolean">true</ds.cond>
    </ds.cond>
    <ds.actions sctype="array">
      <ds.actions sctype="array">
        <ds.actions sctype="string">cancel</ds.actions>
      </ds.actions>
      <ds.actions sctype="array">
        <ds.actions sctype="string">finish</ds.actions>
      </ds.actions>
      <ds.actions sctype="array">
        <ds.actions sctype="string">previous</ds.actions>
      </ds.actions>
      <ds.actions sctype="array">
        <ds.actions sctype="string">do nothing</ds.actions>
      </ds.actions>
      <ds.actions sctype="array"/>
      <ds.actions sctype="array">
        <ds.actions sctype="string">close</ds.actions>
      </ds.actions>
    </ds.actions>
    <ds.exps sctype="array">
      <ds.exps sctype="unknown"/>
      <ds.exps sctype="array">
        <ds.exps sctype="operator">if ($L.condType="readonly") then ($L.fieldIndex in readonly in $L.file=parse($L.condition, 4)) else ($L.fieldIndex in invisible in $L.file=parse($L.condition, 4))</ds.exps>
      </ds.exps>
      <ds.exps sctype="array">
        <ds.exps sctype="operator">cleanup($rightsCondition)</ds.exps>
      </ds.exps>
      <ds.exps sctype="unknown"/>
      <ds.exps sctype="array">
        <ds.exps sctype="operator">if ($L.removeRole=true) then ($L.condition=$L.withoutRoleName) else ($L.condition=$L.withRoleName)</ds.exps>
      </ds.exps>
    </ds.exps>
    <ds.rads NullValue="1" sctype="array">
      <ds.rads sctype="structure">
        <application NullValue="1" type="string"/>
        <thread NullValue="1" type="boolean"/>
        <parms NullValue="1" sctype="array">
          <parms NullValue="1" type="string"/>
        </parms>
        <values NullValue="1" sctype="array">
          <values NullValue="1" type="string"/>
        </values>
      </ds.rads>
    </ds.rads>
    <ds.exps.1 sctype="array">
      <ds.exps.1 sctype="array">
        <ds.exps.1 sctype="operator">cleanup($mySelections)</ds.exps.1>
        <ds.exps.1 sctype="operator">cleanup($originalRoles)</ds.exps.1>
        <ds.exps.1 sctype="operator">cleanup($manualCondition)</ds.exps.1>
        <ds.exps.1 sctype="operator">cleanup($rightsCondition)</ds.exps.1>
      </ds.exps.1>
      <ds.exps.1 sctype="array">
        <ds.exps.1 sctype="operator">cleanup($mySelections)</ds.exps.1>
        <ds.exps.1 sctype="operator">cleanup($originalRoles)</ds.exps.1>
        <ds.exps.1 sctype="operator">cleanup($manualCondition)</ds.exps.1>
        <ds.exps.1 sctype="operator">cleanup($rightsCondition)</ds.exps.1>
        <ds.exps.1 sctype="operator">cleanup($successMessage)</ds.exps.1>
      </ds.exps.1>
    </ds.exps.1>
    <ds.a.options sctype="array">
      <ds.a.options sctype="array">
        <ds.a.options sctype="boolean">true</ds.a.options>
      </ds.a.options>
      <ds.a.options sctype="array">
        <ds.a.options sctype="boolean">true</ds.a.options>
      </ds.a.options>
      <ds.a.options sctype="array">
        <ds.a.options sctype="boolean">true</ds.a.options>
      </ds.a.options>
      <ds.a.options sctype="array">
        <ds.a.options sctype="boolean">true</ds.a.options>
      </ds.a.options>
      <ds.a.options sctype="array"/>
      <ds.a.options sctype="array">
        <ds.a.options sctype="boolean">true</ds.a.options>
      </ds.a.options>
    </ds.a.options>
    <language type="string">ENG</language>
    <sysmodcount type="decimal">1</sysmodcount>
    <sysmoduser type="string">falcon</sysmoduser>
    <sysmodtime type="dateTime">06/15/21 00:51:48</sysmodtime>
    <ds.mod sctype="array">
      <ds.mod sctype="boolean">false</ds.mod>
      <ds.mod sctype="boolean">true</ds.mod>
      <ds.mod sctype="boolean">false</ds.mod>
      <ds.mod sctype="boolean">false</ds.mod>
    </ds.mod>
    <ds.javascript.pre sctype="array">
      <ds.javascript.pre sctype="unknown"/>
      <ds.javascript.pre sctype="string">// save the modified record
 var rc;

  
  rc = system.vars.$L_file.doUpdate();
  
 
  if ( rc != true)
  {
    print( "Error: " + RCtoString(rc));
    
  }

  else 
  {
    print( system.vars.$successMessage); // the message is different, depending on where we came from ( Data policy or security Rights)
  }
</ds.javascript.pre>
      <ds.javascript.pre sctype="unknown"/>
      <ds.javascript.pre sctype="string">
 // extract the existing condition array and the new condition array and eliminate duplicates

   
    var indexStart; 
	var indexEnd ;  
	
    var existingCond;
    var newCond;
    var existingCondArray = new Array();
    var newCondArray = new Array();
         
            
      
      if (system.vars.$L_condition != null &amp;&amp; system.vars.$L_condition != "" ){
        indexStart   = system.functions.index("{",system.vars.$L_condition);
	    indexEnd     = system.functions.index("}",system.vars.$L_condition);    
        existingCond = system.functions.substr(system.vars.$L_condition,indexStart+1,(indexEnd-indexStart)-1);
        existingCondArray=existingCond.split(",");
        
       
      }
      
      if (system.vars.$rightsCondition != null &amp;&amp; system.vars.$rightsCondition != "" ){
     // new condition
        indexStart   = system.functions.index("{",system.vars.$rightsCondition);
	    indexEnd     = system.functions.index("}",system.vars.$rightsCondition);
	    newCond      = system.functions.substr(system.vars.$rightsCondition,indexStart+1,(indexEnd-indexStart)-1);
	    newCondArray = newCond.split(",");
	    
        
       }
                
        // create a union of existing and new conditions with no duplicates
       
        //update the RAD L_condition variable with the result of the union 
        
       if (indexStart &gt; 0 &amp;&amp; indexStart != null) {
          system.vars.$L_condition =  "$G.role isin {" + mergeRemoveDuplicates(existingCondArray,newCondArray) + "}";;
       }
       
      
        //take care of any manual conditions specified   
   
   
   
   if (system.vars.$manualCondition != null &amp;&amp; system.vars.$manualCondition != "" &amp;&amp; indexStart != null &amp;&amp; indexStart &gt; 0)
      {
	    //build the final rights condition
	    
	    system.vars.$L_condition = system.vars.$L_condition + " or (" + system.vars.$manualCondition + ")";
      }

  else if(system.vars.$manualCondition != null)
    {
     system.vars.$L_condition = system.vars.$manualCondition;
    }
  // function merges two arrays and removes duplicates from the resulting array
 function mergeRemoveDuplicates(array1, array2)
  {

     var unionArray = new Array();
    
     unionArray = array1.concat(array2);
            
     var newArray=new Array();
     label:for(var i=0; i&lt;unionArray.length;i++ )
            {  
               for(var j=0; j&lt;newArray.length;j++ )
                 {
                   if(newArray[j]==unionArray[i]) 
                      continue label;
                  }
                    newArray[newArray.length] = unionArray[i];
                }
                return newArray;
           
 }



</ds.javascript.pre>
    </ds.javascript.pre>
    <ds.javascript.post NullValue="1" sctype="array">
      <ds.javascript.post NullValue="1" type="string"/>
    </ds.javascript.post>
  </record>
</recordset>

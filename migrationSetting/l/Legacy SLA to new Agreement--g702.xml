<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<recordset table="migrationSetting">
  <record id="name=&quot;Legacy SLA to new Agreement&quot;" recordid="Legacy SLA to new Agreement">
    <source.table type="string">sla</source.table>
    <target.table type="string">sla</target.table>
    <query type="string">true</query>
    <fields sctype="array">
      <fields sctype="structure">
        <source.field type="string">agreement.id</source.field>
        <target.field type="string">agreement.id</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">1</source.type>
        <target.type type="decimal">1</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">agreements</source.field>
        <target.field type="string">agreements</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">2</source.type>
        <target.type type="decimal">2</target.type>
      </fields>
      <fields sctype="structure">
        <source.field NullValue="1" type="string"/>
        <target.field type="string">category</target.field>
        <desc NullValue="1" type="string"/>
        <source.type NullValue="1" type="decimal"/>
        <target.type type="decimal">2</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">contacts</source.field>
        <target.field type="string">contacts</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">8</source.type>
        <target.type type="decimal">8</target.type>
      </fields>
      <fields sctype="structure">
        <source.field NullValue="1" type="string"/>
        <target.field type="string">current.phase</target.field>
        <desc NullValue="1" type="string"/>
        <source.type NullValue="1" type="decimal"/>
        <target.type type="decimal">2</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">customer</source.field>
        <target.field type="string">customer</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">2</source.type>
        <target.type type="decimal">2</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">description</source.field>
        <target.field type="string">description</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">2</source.type>
        <target.type type="decimal">2</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">display.category</source.field>
        <target.field type="string">display.category</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">2</source.type>
        <target.type type="decimal">2</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">expiration</source.field>
        <target.field type="string">expiration</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">3</source.type>
        <target.type type="decimal">3</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">external.support.groups</source.field>
        <target.field type="string">external.support.groups</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">8</source.type>
        <target.type type="decimal">8</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">folder</source.field>
        <target.field type="string">folder</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">2</source.type>
        <target.type type="decimal">2</target.type>
      </fields>
      <fields sctype="structure">
        <source.field NullValue="1" type="string"/>
        <target.field type="string">joinValue</target.field>
        <desc NullValue="1" type="string"/>
        <source.type NullValue="1" type="decimal"/>
        <target.type type="decimal">2</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">next.review.date</source.field>
        <target.field type="string">next.review.date</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">3</source.type>
        <target.type type="decimal">3</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">owner</source.field>
        <target.field type="string">owner</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">2</source.type>
        <target.type type="decimal">2</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">owner.group</source.field>
        <target.field type="string">owner.group</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">2</source.type>
        <target.type type="decimal">2</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">penalties.incentives</source.field>
        <target.field type="string">penalties.incentives</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">8</source.type>
        <target.type type="decimal">8</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">review.date</source.field>
        <target.field type="string">review.date</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">3</source.type>
        <target.type type="decimal">3</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">review.frequency</source.field>
        <target.field type="string">review.frequency</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">2</source.type>
        <target.type type="decimal">2</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">service.contract</source.field>
        <target.field type="string">service.contract</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">1</source.type>
        <target.type type="decimal">1</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">service.hours</source.field>
        <target.field type="string">service.hours</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">2</source.type>
        <target.type type="decimal">2</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">start</source.field>
        <target.field type="string">start</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">3</source.type>
        <target.type type="decimal">3</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">support.groups</source.field>
        <target.field type="string">support.groups</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">8</source.type>
        <target.type type="decimal">8</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">sysmodcount</source.field>
        <target.field type="string">sysmodcount</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">1</source.type>
        <target.type type="decimal">1</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">sysmodtime</source.field>
        <target.field type="string">sysmodtime</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">3</source.type>
        <target.type type="decimal">3</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">sysmoduser</source.field>
        <target.field type="string">sysmoduser</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">2</source.type>
        <target.type type="decimal">2</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">title</source.field>
        <target.field type="string">title</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">2</source.type>
        <target.type type="decimal">2</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">type</source.field>
        <target.field type="string">type</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">2</source.type>
        <target.type type="decimal">2</target.type>
      </fields>
      <fields sctype="structure">
        <source.field type="string">update.action</source.field>
        <target.field type="string">update.action</target.field>
        <desc NullValue="1" type="string"/>
        <source.type type="decimal">8</source.type>
        <target.type type="decimal">8</target.type>
      </fields>
    </fields>
    <name type="string">Legacy SLA to new Agreement</name>
    <description type="string">Legacy SLA to new Agreement</description>
    <mapping sctype="array">
      <mapping sctype="structure">
        <group type="string">category</group>
        <source.mapping NullValue="1" type="string"/>
        <target.mapping type="string">$value=lib.MigrateSLA.migrateSLA(sourceTable['agreement.id'])</target.mapping>
        <type.mapping type="string">jsCallback</type.mapping>
      </mapping>
      <mapping sctype="structure">
        <group type="string">current.phase</group>
        <source.mapping type="string">expiration&gt;tod()</source.mapping>
        <target.mapping type="string">agreed</target.mapping>
        <type.mapping type="string">fixedValue</type.mapping>
      </mapping>
      <mapping sctype="structure">
        <group type="string">current.phase</group>
        <source.mapping type="string">expiration&lt;tod()</source.mapping>
        <target.mapping type="string">expired</target.mapping>
        <type.mapping type="string">fixedValue</type.mapping>
      </mapping>
      <mapping sctype="structure">
        <group type="string">display.category</group>
        <source.mapping NullValue="1" type="string"/>
        <target.mapping type="string">$value=lib.MigrateSLA.migrateSLA(sourceTable['agreement.id'])</target.mapping>
        <type.mapping type="string">jsCallback</type.mapping>
      </mapping>
      <mapping sctype="structure">
        <group type="string">joinValue</group>
        <source.mapping NullValue="1" type="string"/>
        <target.mapping type="string">default</target.mapping>
        <type.mapping type="string">fixedValue</type.mapping>
      </mapping>
    </mapping>
    <batch type="boolean">false</batch>
    <filter NullValue="1" type="string"/>
    <post.options NullValue="1" type="string"/>
    <post.script type="string">var $ = lib.c.$;
var dataService = $("#dataService");
var dbdictService = $("#dbdictService");

var agreementId = $targetTable["agreement.id"];
var category = $("#agreementService").getAgreementCategory(agreementId);

// update sloresponse
var sqlTable = dbdictService.getPrimaryTable(lib.dbdictHelper.initDbdictFile("sloresponse"))[1];
var batchUpdateSql = "update " + sqlTable + " set AGREEMENT_CATEGORY=\'" + category + "\' where AGREEMENT_ID=" + agreementId;
var result = dataService.executeSQL(batchUpdateSql);

// update slamonthly
sqlTable = dbdictService.getPrimaryTable(lib.dbdictHelper.initDbdictFile("slamonthly"))[1];
batchUpdateSql = "update " + sqlTable + " set AGREEMENT_CATEGORY=\'" + category + "\' where AGREEMENT_ID=" + agreementId;
result = dataService.executeSQL(batchUpdateSql);
</post.script>
  </record>
</recordset>

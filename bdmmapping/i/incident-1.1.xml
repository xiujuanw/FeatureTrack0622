<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<recordset table="bdmmapping">
  <record id="id=&quot;incident&quot; and version=&quot;1.1&quot;" recordid="incident - 1.1">
    <id type="string">incident</id>
    <sysmodtime type="dateTime">11/08/15 14:12:03</sysmodtime>
    <sysmodcount type="decimal">43</sysmodcount>
    <sysmoduser type="string">falcon</sysmoduser>
    <fileName type="string">probsummary</fileName>
    <mappings sctype="array">
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">@type</bdmObjectField>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue type="string">urn:x-hp:2009:software:data_model:type:incident</bdmDefaultValue>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">R</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">@version</bdmObjectField>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue type="string">1.1</bdmDefaultValue>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">R</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">@relationships_included</bdmObjectField>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue type="string">false</bdmDefaultValue>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">R</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">@xmlns</bdmObjectField>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback type="string">$xmlns({"\$":"http://www.hp.com/2009/software/data_model"})</bdmCallback>
        <direction type="string">R</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField NullValue="1" type="string"/>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction NullValue="1" type="string"/>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback type="string">$afterString("urn:x-hp:software:servicemanager:incident:id:")</smCallback>
        <bdmObjectField type="string">global_id</bdmObjectField>
        <smObjectField type="string">id</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback type="string">"urn:x-hp:software:servicemanager:incident:id:$sm.id"</bdmCallback>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">name</bdmObjectField>
        <smObjectField type="string">brief.description</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback type="string">$metaInfo("appendToArray",false)</smCallback>
        <bdmObjectField type="string">description</bdmObjectField>
        <smObjectField type="string">action</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback type="string">combine($sm.action,";")</bdmCallback>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">last_modified_time</bdmObjectField>
        <smObjectField type="string">sysmodtime</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType type="decimal">3</bdmType>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField NullValue="1" type="string"/>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction NullValue="1" type="string"/>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">active_process</bdmObjectField>
        <smObjectField type="string">flag</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">R</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback type="string">$defaultValueOfCreate("1")</smCallback>
        <bdmObjectField type="string">priority</bdmObjectField>
        <smObjectField type="string">priority.code</smObjectField>
        <bdmDefaultValue type="string">1</bdmDefaultValue>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">reference_number</bdmObjectField>
        <smObjectField type="string">number</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField NullValue="1" type="string"/>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction NullValue="1" type="string"/>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">closed_time</bdmObjectField>
        <smObjectField type="string">close.time</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType type="decimal">3</bdmType>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback type="string">if( $isUpdate() ) {
	var status = $bdm.value( "incident_status" );
	if( 'closed' == status ) {
		var v = $bdm.value();
		if( ! v ) {
			$result = "Out of Scope";
		}else {
			$result = v;
		}
	}
}</smCallback>
        <bdmObjectField type="string">completion_code</bdmObjectField>
        <smObjectField type="string">resolution.code</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField NullValue="1" type="string"/>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction NullValue="1" type="string"/>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField NullValue="1" type="string"/>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction NullValue="1" type="string"/>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField NullValue="1" type="string"/>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction NullValue="1" type="string"/>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">impact_scope</bdmObjectField>
        <smObjectField type="string">initial.impact</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup type="string">impact</valMappingGroup>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField NullValue="1" type="string"/>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction NullValue="1" type="string"/>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">solution</bdmObjectField>
        <smObjectField type="string">resolution</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback type="string">combine($sm.resolution,";")</bdmCallback>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField NullValue="1" type="string"/>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction NullValue="1" type="string"/>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">urgency</bdmObjectField>
        <smObjectField type="string">severity</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField NullValue="1" type="string"/>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction NullValue="1" type="string"/>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback type="string">if ($isCreate()) {
	var name;

	// 1. try the 'is_registered_for'
	var global_id = $bdm.value();
	if (global_id) {
		var dev_id = $select("device", 'ucmdb.id="' + global_id + '"');
		if (dev_id)
			name = dev_id['logical.name'];
	}

	// 2. try the ‘configuration_item.name’
	if (!name) {
		var dsName = $bdm.is_registered_for.configuration_item.name;
		if (dsName) {
			var dev_name = $select("device", 'sm.device.display.name="' + dsName + '"');
			if (dev_name)
				name = dev_name['logical.name'];
		}
	}

	//if your system need the following condition. please uncomment them
	// 3. try the direct dns name
	/**
	if (!name) {
	var dns_name = $bdm.is_registered_for.configuration_item.primary_dns_name;
	if (dns_name) {
	var dev_name = $select("device", 'network.name="' + dns_name + '"');
	if (dev_name) name = dev_name['logical.name'];
	}
	}
	 **/

	// 4. try the 'is_hosted_on'
	/**
	if (!name) {
	var host_id = $bdm.is_registered_for.configuration_item.is_hosted_on.target_global_id;
	if (host_id) {
	var dev_host = $select("device", 'ucmdb.id="' + host_id + '"');
	if (dev_host) name = dev_host['logical.name'];
	}
	}
	 **/

	/**
	// 5. try the 'is_hosted_on.configuration_item.name'
	if (!name) {
	var hostlogicalName = $bdm.is_registered_for.is_hosted_on.configuration_item.name;
	if (hostlogicalName) {
	var dev_name = $select("device", 'sm.device.display.name="' + hostlogicalName + '"');
	if (dev_name) name = dev_name['logical.name'];
	}
	}


	// 6. try the host dns name
	/**
	if (!name) {
	var host_dns_name = $bdm.is_registered_for.configuration_item.is_hosted_on.configuration_item.primary_dns_name;
	if (host_dns_name) {
	var dev_name = $select("device", 'network.name="' + host_dns_name + '"');
	if (dev_name) name = dev_name['logical.name'];
	}
	}
	 **/

	$result = name;
}
</smCallback>
        <bdmObjectField type="string">is_registered_for/target_global_id</bdmObjectField>
        <smObjectField type="string">logical.name</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">L</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField NullValue="1" type="string"/>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction NullValue="1" type="string"/>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback type="string">$defaultValueOfCreate("incident")</smCallback>
        <bdmObjectField type="string">incident_type</bdmObjectField>
        <smObjectField type="string">category</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback type="string">if ($isCreate()) {
  var affects_item;
 
  // 1. try the global id of the 'affects_business_service'
  var id = $bdm.value();
  if (id) {
    var id_dev = $select('device', 'ucmdb.id="' + id + '" and device.type="bizservice"');
    if (id_dev) affects_item = id_dev['logical.name'];
  }
 
  // 2. try the name of the 'affects_business_service' &amp; then the 'affects' for backwards compatibility
  if (!affects_item) {
    var name = $bdm.affects_business_service.configuration_item.name;
    if (name) {
      var name_dev = $select('device', 'sm.device.display.name="' + name + '" and device.type="bizservice"');
      if (name_dev) affects_item = name_dev['logical.name'];
    }
  }
 
  //set default business_service, please change the "Applications" if necessary
  if(!affects_item) affects_item=$getBizService("Applications");

  // Assign the result or the default
  $result = affects_item;
}
</smCallback>
        <bdmObjectField type="string">affects_business_service/target_global_id</bdmObjectField>
        <smObjectField type="string">affected.item</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback type="string">/*
 *@reference No. 33061 requirement in QC
 */
if ($isCreate()) { // This mechanism should only run on the creation of a new incident
	var assign;

	// 1) The assignment group passed in by OMi (1st priority)
	var group = $bdm.value();
	if (group) {
		var assignment = $select("assignment", 'name="' + group + '"');
		if (assignment)
			assign = group;
	}

	// 2)  The Incident 'Affected Service' assignment (2nd priority)
	if (!assign) {
		var item = $sm.value('affected.item');
		if (item) {
			var dev = $select("device", 'logical.name="' + item + '"');
			if (dev) {
				var dev_assign = $select("assignment", 'name="' + dev['assignment'] + '"');
				if (dev_assign)
					assign = dev['assignment'];
			}
		}
	}

	// 3)  The Incident type default assignment (3rd priority)
	if (!assign) {
		var type = $bdm.incident_type;
		if (type) {
			var cat = $select("category", 'name="' + type + '"');
			if (cat)
				assign = cat['default.assign'];
		}
	}

	// 4)  The Incident 'Affected CI' assignment (4th priority)
	if (!assign) {
		var name = $sm.value('logical.name');
		if (name) {
			var ci = $select("device", 'logical.name="' + name + '"');
			if (ci) {
				var ci_assign = $select("assignment", 'name="' + ci['assignment'] + '"');
				if (ci_assign)
					assign = ci['assignment'];
			}
		}
	}

	// 5)  A default assignment group if no other criteria is met
	$result = (assign) ? assign : "Application";
}
</smCallback>
        <bdmObjectField type="string">has_assigned_group/functional_group/name</bdmObjectField>
        <smObjectField type="string">assignment</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">is_requested_by/party/display_label</bdmObjectField>
        <smObjectField type="string">contact.name</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback type="string">var contact_name = $sm.contact_name;
if( contact_name ) {
	var requestedBy = $select("contacts",'contact.name="' + contact_name + '"');
	$ctx.set("requestedBy",  requestedBy);
	$result = requestedBy ? ( requestedBy['first.name'] + " " + requestedBy['last.name'] ): null;
}</bdmCallback>
        <direction type="string">R</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">is_requested_by/party/email</bdmObjectField>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback type="string">var requestedBy = $ctx.get("requestedBy");
$result = requestedBy ? requestedBy['email'] : null;</bdmCallback>
        <direction type="string">R</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField NullValue="1" type="string"/>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction NullValue="1" type="string"/>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField NullValue="1" type="string"/>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction NullValue="1" type="string"/>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">is_owned_by/party/display_label</bdmObjectField>
        <smObjectField type="string">ticket.owner</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback type="string">var ticket_owner = $sm.ticket_owner;
if( ticket_owner ) {
	var ownedBy = $select("contacts",'operator.id="' + ticket_owner + '"');
	$ctx.set("ownedBy",  ownedBy);
	$result = ownedBy ? ( ownedBy['first.name'] + " " + ownedBy['last.name'] ) : null;
}</bdmCallback>
        <direction type="string">R</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">is_owned_by/party/email</bdmObjectField>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback type="string">var ownedBy = $ctx.get("ownedBy");
$result = ownedBy ? ownedBy['email'] : null;</bdmCallback>
        <direction type="string">R</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField NullValue="1" type="string"/>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction NullValue="1" type="string"/>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField NullValue="1" type="string"/>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction NullValue="1" type="string"/>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback type="string">$result=[$bdm.value()];
$ctx.set('activity_log', $result);</smCallback>
        <bdmObjectField type="string">activity_log/description</bdmObjectField>
        <smObjectField type="string">update.action</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback type="string">combine($sm.update_action,"\r\n")</bdmCallback>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">incident_status</bdmObjectField>
        <smObjectField type="string">problem.status</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup type="string">status</valMappingGroup>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">outage_end_time</bdmObjectField>
        <smObjectField type="string">downtime.end</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType type="decimal">3</bdmType>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">outage_start_time</bdmObjectField>
        <smObjectField type="string">downtime.start</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType type="decimal">3</bdmType>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">external_process_reference</bdmObjectField>
        <smObjectField type="string">external.process.reference</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback type="string">if($sm.external_process_reference != null &amp;&amp; $sm.external_process_reference[0] != null){
	

	var ref = $sm.external_process_reference[0].substring( $ctx.get('omi.reference.prefix').length);
	

	var interactionType = ref.substring( ref.indexOf( ':' ) + 1, ref.lastIndexOf( ':' ) );
	var tarr = interactionType.split( '|' );
	$result =  $ctx.get('sm.reference.prefix')  + $ctx.get( 'sm.mgr.id' ) + ':'
					+ tarr[0] + '|' + tarr[1] + '|' + ( 'informational' == tarr[1] ? 'requester' : 'provider' )
					+ ':$sm.id';
}
</bdmCallback>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField NullValue="1" type="string"/>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction NullValue="1" type="string"/>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback type="string">$defaultValueOfCreate("failure")</smCallback>
        <bdmObjectField type="string">category</bdmObjectField>
        <smObjectField type="string">subcategory</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback type="string">if($bdm.category ==null || $bdm.category == ""){
	// Case 1: category is empty
	$result = "error message";
}else if($bdm.value() != null &amp;&amp; $bdm.value() != ""){
	// Case 2: both category and sub-category is not empty
	var producttype = new SCFile("producttype");
	var code = producttype.doSelect("subcategory=\"" + $bdm.category + "\" and product.type=\""+ $bdm.value()  +"\" and category=\"incident\" and active=true");
	if(code == RC_SUCCESS){
		// Case 2.1: valid
		$result = $bdm.value() ;
	}else{
		print("[BDM Mapping] product.type is invalid, select clause failed to be executed:  " + RCtoString(code));
		code = producttype.doSelect("subcategory=\"" + $bdm.category + "\" and active=true and category=\"incident\"");
		if(code == RC_SUCCESS){
			//Case 2.2.1: subcategory is valid, product.type is invalid
			print("[BDM Mapping] Replace invalid product.type '" + $bdm.value() + "' with '" + producttype["product.type"] + "'");
			$result = producttype["product.type"];
			
		}else{
			//Case 2.2.2: subcategory is invalid
			print("[BDM Mapping] Replace invalid subcategory '" + $bdm.value() + "' with 'failure'");
			$sm.setValue("failure", "subcategory");
			$result = "error message";
		}
	}
}else{
	// Case 3: category is not empty but sub-category is empty
	var producttype = new SCFile("producttype");
	var code = producttype.doSelect("subcategory=\"" + $bdm.category + "\" and active=true and category=\"incident\"");
	if(code == RC_SUCCESS){
		// Case 3.1: category is valid
		print("[BDM Mapping] Find and set to default subcategory: " + producttype["product.type"]);
		$result = producttype["product.type"];
	}else{
		// Case 3.2: category is invalid
		print("[BDM Mapping] Replace invalid category '" + $bdm.category + "' with 'failure'");
		$sm.setValue("failure", "subcategory");
		$result = "error message";
	}	
}</smCallback>
        <bdmObjectField type="string">sub_category</bdmObjectField>
        <smObjectField type="string">product.type</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">LR</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">is_recorded_by/person/display_label</bdmObjectField>
        <smObjectField type="string">opened.by</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback type="string">var opened_by = $sm.opened_by;
if( opened_by ) {
	var recordedBy = $select("contacts",'operator.id="' + opened_by + '"');
	$ctx.set("recordedBy", recordedBy);
	$result = recordedBy ? ( recordedBy['first.name'] + " " + recordedBy['last.name'] ) : null;
}</bdmCallback>
        <direction type="string">R</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">is_recorded_by/person/email</bdmObjectField>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback type="string">var recordedBy = $ctx.get("recordedBy");
$result = recordedBy ? recordedBy['email'] : null;</bdmCallback>
        <direction type="string">R</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField NullValue="1" type="string"/>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction NullValue="1" type="string"/>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField NullValue="1" type="string"/>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction NullValue="1" type="string"/>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">has_assigned/party/display_label</bdmObjectField>
        <smObjectField type="string">assignee.name</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback type="string">var assignee_name = $sm.assignee_name;
if( assignee_name ) {
	var hasAssigned = $select("contacts",'operator.id="' + assignee_name + '"');
	$ctx.set("hasAssigned", hasAssigned);
	$result = hasAssigned ? ( hasAssigned['first.name'] + " " + hasAssigned['last.name'] ) : null;
}</bdmCallback>
        <direction type="string">R</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">has_assigned/party/email</bdmObjectField>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback type="string">var hasAssigned = $ctx.get("hasAssigned");
$result = hasAssigned ? hasAssigned['email'] : null;</bdmCallback>
        <direction type="string">R</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">is_registered_for/@target_role</bdmObjectField>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue type="string">urn:x-hp:2009:software:data_model:relationship:indident:is_registered_for:configuration_item</bdmDefaultValue>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">R</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">is_registered_for/target_global_id</bdmObjectField>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback type="string">var logical_name = $sm.logical_name;
if( logical_name ) {
	var affected_ci = $select("device",'logical.name="' + logical_name + '"');
	$ctx.set("affected_ci", affected_ci);
	$result = affected_ci ? affected_ci['ucmdb.id'] : null;
}</bdmCallback>
        <direction type="string">R</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">is_registered_for/target_type</bdmObjectField>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue type="string">urn:x-hp:2009:software:data_model:type:node</bdmDefaultValue>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">R</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">is_registered_for/configuration_item/id</bdmObjectField>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback type="string">var affected_ci = $ctx.get("affected_ci");
if( affected_ci ) {
	$result = affected_ci['id'];
}</bdmCallback>
        <direction type="string">R</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">is_registered_for/configuration_item/type</bdmObjectField>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback type="string">var affected_ci = $ctx.get("affected_ci");
if( affected_ci ) {
	$result = affected_ci['type'];
}</bdmCallback>
        <direction type="string">R</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">is_registered_for/configuration_item/description</bdmObjectField>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback type="string">var affected_ci = $ctx.get("affected_ci");
if( affected_ci ) {
	$result = combine(affected_ci['comments'], '\r\n');
}</bdmCallback>
        <direction type="string">R</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">is_caused_by/@target_role</bdmObjectField>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue type="string">urn:x-hp:2009:software:data_model:relationship:incident:is_caused_by:incident</bdmDefaultValue>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">L</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback type="string">
if( $isUpdate() ) {
    var refNum = $bdm.reference_number;
    var globalId = null;
    if( ! refNum ) {
        globalId = $bdm.global_id;
        globalId = ( globalId ? globalId.substring( "urn:x-hp:software:servicemanager:incident:id:".length ) : '' );
    }
    var masterRefNum = $bdm.value();
    if( ( refNum || globalId ) &amp;&amp; masterRefNum ) {
        var masterRecordExisted = false, refRecordExisted = false, refFile = {};
        var qry = ( refNum ? 'number isin {"' + refNum + '", "' + masterRefNum + '"}'
                        : 'number="' + masterRefNum + '" or id="' + globalId + '"' );
        var pfile = $select( 'probsummary', qry );
        var rc = pfile.getFirst();
        while( rc != RC_NO_MORE ) {
            if( pfile.number == refNum || ( globalId &amp;&amp; ( pfile.id == globalId ) ) ) {
                refRecordExisted = true;
                refNum = pfile.number;
                refFile.open_time = pfile.open_time;
                refFile.problem_status = pfile.problem_status;
                refFile.category = pfile.category;
                refFile.brief_description = pfile.brief_description;
            }else if( pfile.number == masterRefNum ) {
                masterRecordExisted = true;
            }
            rc = pfile.getNext();
        }
		if( masterRecordExisted &amp;&amp; refRecordExisted
            &amp;&amp; ( refNum != masterRefNum ) ) {
            var name = "problem";
			var targetRole = $bdm.value( "is_caused_by/@target_role" );
            if( "urn:x-hp:2009:software:data_model:relationship:incident:is_caused_by:incident" == targetRole ) {
				name = "problem";
            }
            var scr = new SCFile( "screlation" );
            scr.source = masterRefNum;
            scr.source_filename = name;
            scr.source_active = true;
            scr.depend = refNum;
            scr.depend_filename = name;
            scr.depend_active = true;
            var desc = new SCDatum();
            desc.setType( 8 ); // array
            desc.push( refFile.open_time );
            desc.push( refFile.problem_status );
            desc.push( refFile.category );
            desc.push( refFile.brief_description );
            scr.desc = desc;
            scr.doSave();
        }
    }
}
</smCallback>
        <bdmObjectField type="string">is_caused_by/master_reference_number</bdmObjectField>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">L</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback NullValue="1" type="string"/>
        <bdmObjectField type="string">queryHash</bdmObjectField>
        <smObjectField NullValue="1" type="string"/>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback type="string">queryHash($sm.number)</bdmCallback>
        <direction type="string">R</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
      <mappings sctype="structure">
        <smCallback type="string">var affects_IDs = $bdm.value();
var isPrimerys = $bdm.affects.configuration_item.primary;
var affects = new Array();
if (affects_IDs) {
	if (affects_IDs instanceof Array) {
		for (var i = 0; i &lt; affects_IDs.length; i++) {
			if (isPrimerys[i] != true &amp;&amp; isPrimerys[i] != 'true' &amp;&amp; affects_IDs[i] != '') {
				var dev_host = $select("device", 'ucmdb.id="' + affects_IDs[i] + '"');
				if (dev_host)
					affects.push(dev_host['logical.name']);
			}
		}
	} else {
		if (isPrimerys != true &amp;&amp; isPrimerys != 'true' &amp;&amp; affects_IDs != '') {
			var dev_host = $select("device", 'ucmdb.id="' + affects_IDs + '"');
			if (dev_host)
				affects.push(dev_host['logical.name']);
		}
	}
}

if (affects.length == 0) {
	var names = $bdm.affects.configuration_item.name;
	if (names) {
		if (names instanceof Array) {
			for (var i = 0; i &lt; names.length; i++) {
				if (isPrimerys[i] != true &amp;&amp; isPrimerys[i] != 'true' &amp;&amp; names[i] != '') {
					var dev_host = $select("device", 'sm.device.display.name="' + names[i] + '"');
					if (dev_host)
						affects.push(dev_host['logical.name']);
				}
			}
		} else {
			if (isPrimerys != true &amp;&amp; isPrimerys != 'true' &amp;&amp; names != '') {
				var dev_host = $select("device", 'sm.device.display.name="' + names + '"');
				if (dev_host)
					affects.push(dev_host['logical.name']);
			}
		}
	}
}

if (affects.length &gt; 0)
	$result = affects;
</smCallback>
        <bdmObjectField type="string">affects/configuration_item/global_id</bdmObjectField>
        <smObjectField type="string">affected.services</smObjectField>
        <bdmDefaultValue NullValue="1" type="string"/>
        <bdmType NullValue="1" type="decimal"/>
        <bdmCallback NullValue="1" type="string"/>
        <direction type="string">L</direction>
        <smDefaultValue NullValue="1" type="string"/>
        <valMappingGroup NullValue="1" type="string"/>
        <description NullValue="1" type="string"/>
      </mappings>
    </mappings>
    <valuemappings sctype="array">
      <valuemappings sctype="structure">
        <bdmValue type="string">enterprise</bdmValue>
        <comment type="string">enterprise</comment>
        <groupName type="string">impact</groupName>
        <smValue type="string">1</smValue>
      </valuemappings>
      <valuemappings sctype="structure">
        <bdmValue type="string">site-dept</bdmValue>
        <comment type="string">site-dept</comment>
        <groupName type="string">impact</groupName>
        <smValue type="string">2</smValue>
      </valuemappings>
      <valuemappings sctype="structure">
        <bdmValue type="string">multiple-users</bdmValue>
        <comment type="string">multiple-users</comment>
        <groupName type="string">impact</groupName>
        <smValue type="string">3</smValue>
      </valuemappings>
      <valuemappings sctype="structure">
        <bdmValue type="string">user</bdmValue>
        <comment type="string">user</comment>
        <groupName type="string">impact</groupName>
        <smValue type="string">4</smValue>
      </valuemappings>
      <valuemappings sctype="structure">
        <bdmValue type="string">open</bdmValue>
        <comment NullValue="1" type="string"/>
        <groupName type="string">status</groupName>
        <smValue type="string">Open</smValue>
      </valuemappings>
      <valuemappings sctype="structure">
        <bdmValue type="string">closed</bdmValue>
        <comment NullValue="1" type="string"/>
        <groupName type="string">status</groupName>
        <smValue type="string">Closed</smValue>
      </valuemappings>
      <valuemappings sctype="structure">
        <bdmValue type="string">accepted</bdmValue>
        <comment NullValue="1" type="string"/>
        <groupName type="string">status</groupName>
        <smValue type="string">Accepted</smValue>
      </valuemappings>
      <valuemappings sctype="structure">
        <bdmValue type="string">work-in-progress</bdmValue>
        <comment NullValue="1" type="string"/>
        <groupName type="string">status</groupName>
        <smValue type="string">Work In Progress</smValue>
      </valuemappings>
      <valuemappings sctype="structure">
        <bdmValue type="string">rejected</bdmValue>
        <comment NullValue="1" type="string"/>
        <groupName type="string">status</groupName>
        <smValue type="string">Rejected</smValue>
      </valuemappings>
      <valuemappings sctype="structure">
        <bdmValue type="string">resolved</bdmValue>
        <comment NullValue="1" type="string"/>
        <groupName type="string">status</groupName>
        <smValue type="string">Resolved</smValue>
      </valuemappings>
      <valuemappings sctype="structure">
        <bdmValue type="string">categorize</bdmValue>
        <comment NullValue="1" type="string"/>
        <groupName type="string">status</groupName>
        <smValue type="string">Categorize</smValue>
      </valuemappings>
      <valuemappings sctype="structure">
        <bdmValue type="string">assign</bdmValue>
        <comment NullValue="1" type="string"/>
        <groupName type="string">status</groupName>
        <smValue type="string">Assign</smValue>
      </valuemappings>
      <valuemappings sctype="structure">
        <bdmValue type="string">pending-customer</bdmValue>
        <comment NullValue="1" type="string"/>
        <groupName type="string">status</groupName>
        <smValue type="string">Pending Customer</smValue>
      </valuemappings>
      <valuemappings sctype="structure">
        <bdmValue type="string">pending-evidence</bdmValue>
        <comment NullValue="1" type="string"/>
        <groupName type="string">status</groupName>
        <smValue type="string">Pending Evidence</smValue>
      </valuemappings>
      <valuemappings sctype="structure">
        <bdmValue type="string">pending-vendor</bdmValue>
        <comment NullValue="1" type="string"/>
        <groupName type="string">status</groupName>
        <smValue type="string">Pending Vendor</smValue>
      </valuemappings>
      <valuemappings sctype="structure">
        <bdmValue type="string">pending-other</bdmValue>
        <comment NullValue="1" type="string"/>
        <groupName type="string">status</groupName>
        <smValue type="string">Pending Other</smValue>
      </valuemappings>
      <valuemappings sctype="structure">
        <bdmValue type="string">suspended</bdmValue>
        <comment NullValue="1" type="string"/>
        <groupName type="string">status</groupName>
        <smValue type="string">Suspended</smValue>
      </valuemappings>
    </valuemappings>
    <atommappings sctype="array">
      <atommappings sctype="structure">
        <atomCallback NullValue="1" type="string"/>
        <atomDefaultValue NullValue="1" type="string"/>
        <atomDescription NullValue="1" type="string"/>
        <atomObjectField type="string">title</atomObjectField>
        <atomType type="decimal">1</atomType>
        <asmCallback NullValue="1" type="string"/>
        <asmDefaultValue NullValue="1" type="string"/>
        <asmObjectField type="string">reference_number</asmObjectField>
        <atomDirection NullValue="1" type="string"/>
        <atomValueMappingGroup NullValue="1" type="string"/>
      </atommappings>
      <atommappings sctype="structure">
        <atomCallback NullValue="1" type="string"/>
        <atomDefaultValue NullValue="1" type="string"/>
        <atomDescription NullValue="1" type="string"/>
        <atomObjectField type="string">updated</atomObjectField>
        <atomType type="decimal">3</atomType>
        <asmCallback NullValue="1" type="string"/>
        <asmDefaultValue NullValue="1" type="string"/>
        <asmObjectField type="string">last_modified_time</asmObjectField>
        <atomDirection NullValue="1" type="string"/>
        <atomValueMappingGroup NullValue="1" type="string"/>
      </atommappings>
      <atommappings sctype="structure">
        <atomCallback NullValue="1" type="string"/>
        <atomDefaultValue NullValue="1" type="string"/>
        <atomDescription NullValue="1" type="string"/>
        <atomObjectField type="string">summary</atomObjectField>
        <atomType type="decimal">1</atomType>
        <asmCallback NullValue="1" type="string"/>
        <asmDefaultValue NullValue="1" type="string"/>
        <asmObjectField type="string">description</asmObjectField>
        <atomDirection NullValue="1" type="string"/>
        <atomValueMappingGroup NullValue="1" type="string"/>
      </atommappings>
      <atommappings sctype="structure">
        <atomCallback NullValue="1" type="string"/>
        <atomDefaultValue NullValue="1" type="string"/>
        <atomDescription NullValue="1" type="string"/>
        <atomObjectField type="string">id</atomObjectField>
        <atomType type="decimal">1</atomType>
        <asmCallback NullValue="1" type="string"/>
        <asmDefaultValue NullValue="1" type="string"/>
        <asmObjectField type="string">global_id</asmObjectField>
        <atomDirection NullValue="1" type="string"/>
        <atomValueMappingGroup NullValue="1" type="string"/>
      </atommappings>
    </atommappings>
    <atomcategories NullValue="1" sctype="array">
      <atomcategories NullValue="1" type="string"/>
    </atomcategories>
    <version type="string">1.1</version>
    <bLocked type="string">false</bLocked>
    <configuration NullValue="1" sctype="array">
      <configuration sctype="structure">
        <cName NullValue="1" type="string"/>
        <cValue NullValue="1" type="string"/>
      </configuration>
    </configuration>
  </record>
</recordset>

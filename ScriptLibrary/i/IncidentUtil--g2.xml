<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<recordset table="ScriptLibrary">
  <record id="name=&quot;IncidentUtil&quot;" recordid="IncidentUtil">
    <name type="string">IncidentUtil</name>
    <script type="string">var $ = lib.c.$;

/**
 *  This functions build and return incident task attachment HTML tables
 *   
 *  @param {String} incident id
 *  @returns {string} incident task attachment HTML table
 */
function getTaskAttachmentHTML(incidentId) {

    var numbers = [];
    $("imTask", SCFILE_READONLY).setFields(['id']).setOrderBy(['id'], [SCFILE_DSC]).select('parent.incident="' + incidentId + '"').iterate(function(task) {
        numbers.push(task.id);
    });

    var sHtmlReturn = lib.AttachmentUtil.getAttachmentHtmlCSS() + lib.AttachmentUtil.getAttachmentHtmlTable("imTask", numbers);
    
    return sHtmlReturn;
}


/**
 *  Return the total attachment number of incident tasks
 *   
 *  @param {String} incident id
 *  @returns {Number} the total attachment number of task records
 */
function countTaskAttachments(incidentId) {
    
    var attach_number = 0;

    $("imTask", SCFILE_READONLY).setFields(['id']).select('parent.incident="' + incidentId + '"').iterate(function(task) {
        attach_number += lib.AttachmentUtil.countAttachments(task.id, "imTask");
    });

    return attach_number;
}</script>
    <package type="string">Incident</package>
    <sysmodtime type="dateTime">09/29/19 18:21:35</sysmodtime>
    <sysmoduser type="string">zhangqi</sysmoduser>
    <sysmodcount type="decimal">5</sysmodcount>
    <prgnsystem NullValue="1" type="boolean"/>
    <sysrestricted type="boolean">true</sysrestricted>
  </record>
</recordset>
